""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"                              Plug
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

call plug#begin('$VIM/vimfiles/my_plugin')

"ç¾åŒ–
Plug 'morhetz/gruvbox'
Plug 'mhinz/vim-startify'
Plug 'itchyny/lightline.vim'

"æ–‡ä»¶æ ‘
Plug 'scrooloose/nerdtree', { 'on':  'NERDTreeToggle' }
Plug 'Xuyuanp/nerdtree-git-plugin', { 'on':  'NERDTreeToggle' }

"Git
Plug 'tpope/vim-fugitive'

"åŒ¹é…è·³è½¬
Plug 'vim-scripts/matchit.zip'

"å¼‚æ­¥è¯­æ³•æ£€æŸ¥
Plug 'w0rp/ale'

"å¯¹é½
Plug 'junegunn/vim-easy-align'

"å¯¹é½çº¿
Plug 'Yggdroot/indentLine'

"æ’¤é”€æ ‘
Plug 'mbbill/undotree'

"multiple selections
Plug 'terryma/vim-multiple-cursors'

"Highlights trailing whitespace
Plug 'bronson/vim-trailing-whitespace'

"æ‹¬å·è¡¥å…¨
Plug 'jiangmiao/auto-pairs'

"ä»£ç è¡¥å…¨
Plug 'maralla/completor.vim'
Plug 'maralla/completor-neosnippet'
Plug 'Shougo/neosnippet-snippets'

"Tagæ–‡ä»¶çª—å£
Plug 'vim-scripts/taglist.vim'

"æ³¨é‡Š
Plug 'scrooloose/nerdcommenter'

"è¯­è¨€ç±»
Plug 'plasticboy/vim-markdown', {'for': 'markdown'}
Plug 'mattn/emmet-vim', {'for': 'html'}

call plug#end()

filetype indent plugin on

""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"                           common setting
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

""""""""""""""""""""""""""""""""""""""""""""
"General
""""""""""""""""""""""""""""""""""""""""""""
set nocompatible
set nobackup
set noswapfile
set history=1024
"è‡ªåŠ¨è®¾ç½®å½“å‰ç›®å½•ä¸ºæ­£åœ¨ç¼–è¾‘çš„ç›®å½•
set autochdir
autocmd BufEnter * silent! lcd %:p:h:gs/ /\\ /

set whichwrap=b,s,<,>,[,]
set nobomb
set backspace=indent,eol,start whichwrap+=<,>,[,]
" Vim çš„é»˜è®¤å¯„å­˜å™¨å’Œç³»ç»Ÿå‰ªè´´æ¿å…±äº«
set clipboard+=unnamed
" è®¾ç½® alt é”®ä¸æ˜ å°„åˆ°èœå•æ 
set winaltkeys=no

"å…³é—­æç¤ºéŸ³
set noeb
set vb t_vb=

""""""""""""""""""""""""""""""""""""""""""""
"Encoding
""""""""""""""""""""""""""""""""""""""""""""
set tenc=utf-8
set encoding=utf-8
set fileencodings=utf-8,chinese,latin-1
"è§£å†³consleè¾“å‡ºä¹±ç 
language messages zh_CN.utf-8

""""""""""""""""""""""""""""""""""""""""""""
"GUI
""""""""""""""""""""""""""""""""""""""""""""
" è®¾å®šå‘½ä»¤è¡Œçš„è¡Œæ•°ä¸º 1
set cmdheight=2
" æ˜¾ç¤ºçŠ¶æ€æ  (é»˜è®¤å€¼ä¸º 1, æ— æ³•æ˜¾ç¤ºçŠ¶æ€æ )
set laststatus=2
" è®¾ç½® gvim æ˜¾ç¤ºå­—ä½“
set guifont=Inziu_Iosevka_SC:h12

" ä½¿ç”¨æŒ‡ä»¤å˜å¤§å˜å°
command! FontBigger  :let &guifont = substitute(&guifont, '\d\+$', '\=submatch(0)+1', '')
command! FontSmaller :let &guifont = substitute(&guifont, '\d\+$', '\=submatch(0)-1', '')

set cursorline
set cursorcolumn

set t_Co=256
if has("gui_running")
  " Switch on highlighting the last used search pattern.
  set hlsearch
endif

" å¼€å¯å®æ—¶æœç´¢åŠŸèƒ½
set incsearch
" æœç´¢æ—¶å¤§å°å†™ä¸æ•æ„Ÿ
set ignorecase

set number
set relativenumber
" çª—å£å¤§å°
set lines=30 columns=100

" åˆ†å‰²å‡ºæ¥çš„çª—å£ä½äºå½“å‰çª—å£ä¸‹è¾¹/å³è¾¹
set splitbelow
set splitright

"ä¸æ˜¾ç¤ºå·¥å…·/èœå•æ 
set guioptions-=T
set guioptions-=m
set guioptions-=L
set guioptions-=r
set guioptions-=b

""""""""""""""""""""""""""""""""""""""""""""
"Format
""""""""""""""""""""""""""""""""""""""""""""
set autoindent
set smartindent
set tabstop=4
set shiftwidth=4
set softtabstop=4
set expandtab
syntax on

"set foldmethod=marker
"å…³é—­è‡ªåŠ¨æŠ˜å 
set nofoldenable

""""""""""""""""""""""""""""""""""""""""""""
"Key
""""""""""""""""""""""""""""""""""""""""""""
"set my leader
let mapleader=","

" å®šä¹‰å¿«æ·é”®å…³é—­å½“å‰åˆ†å‰²çª—å£
nmap <Leader>q :q<CR>
" å®šä¹‰å¿«æ·é”®ä¿å­˜å½“å‰çª—å£å†…å®¹
nmap <Leader>w :w<CR>

" å®šä¹‰é€€å‡ºæ¨¡å¼å¿«æ·é”®
inoremap jk <ESC>

" å®šä¹‰vimè®¾ç½®æ–‡ä»¶å†…å®¹ç›¸å…³
nnoremap <leader>ev :edit $MYVIMRC<CR>
nnoremap <leader>sv :source $MYVIMRC<CR>
autocmd BufWritePost $MYVIMRC source $MYVIMRC

" æ‰“å¼€å½“å‰ç›®å½• explorer/cmd
nmap <silent> <leader>exp :!start explorer %:p:h<CR>
nmap <silent> <leader>cmd :!start cmd /k cd %:p:h<cr>

" å¤åˆ¶å½“å‰æ–‡ä»¶/è·¯å¾„åˆ°å‰ªè´´æ¿
nmap <leader>cf :let @*=substitute(expand("%"), "/", "\\", "g")<CR>
nmap <leader>cp :let @*=substitute(expand("%:p"), "/", "\\", "g")<CR>

" å¿«é€Ÿäº¤æ¢å½“å‰è¡Œä½ç½®
nnoremap [m  :<c-u>execute 'move -1-'. v:count1<cr>
nnoremap ]m  :<c-u>execute 'move +'. v:count1<cr>

" ä¸€é”®è¿è¡Œ
map <F5> :call CompileRunGcc()<CR>
func! CompileRunGcc()
    exec "w"
    if &filetype == 'c'
        exec "!g++ % -o %<"
        exec "! %<"
    elseif &filetype == 'cpp'
        exec "!g++ % -o %<"
        exec "! %<"
    elseif &filetype == 'java'
        exec "!javac %"
        exec "!java %<"
    elseif &filetype == 'python'
        exec "!pythonvim %"
    elseif &filetype == 'sh'
        :!%
    endif
endfunc


""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"                           Plug setting
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"ç¾åŒ–
""""""""""""""""""""""""""""""""""""""""""""
set background=dark
colorscheme gruvbox

set noshowmode
let g:lightline = {
      \ 'colorscheme': 'material',
      \ 'active': {
      \   'left': [ ['mode', 'paste'],
      \             ['fugitive', 'readonly', 'filename', 'modified'] ],
      \   'right': [ [ 'lineinfo' ],
      \              [ 'percent' ],
      \              [ 'fileformat', 'fileencoding', 'filetype' ] ]
      \ },
      \ 'component': {
      \   'readonly': '%{&filetype=="help"?"":&readonly?"ğŸ”’":""}',
      \   'modified': '%{&filetype=="help"?"":&modified?"+":&modifiable?"":"-"}',
      \   'fugitive': '%{exists("*fugitive#head")?fugitive#head():""}'
      \ },
      \ 'component_visible_condition': {
      \   'readonly': '(&filetype!="help"&& &readonly)',
      \   'modified': '(&filetype!="help"&&(&modified||!&modifiable))',
      \   'fugitive': '(exists("*fugitive#head") && ""!=fugitive#head())'
      \ }
      \ }

"æ–‡ä»¶æ ‘
""""""""""""""""""""""""""""""""""""""""""""
map <leader>n :NERDTreeToggle<CR>       " å…³é—­NERDTreeå¿«æ·é”®
""å½“NERDTreeä¸ºå‰©ä¸‹çš„å”¯ä¸€çª—å£æ—¶è‡ªåŠ¨å…³é—­
autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree()) | q | endif
""ä¿®æ”¹æ ‘çš„æ˜¾ç¤ºå›¾æ ‡
let g:NERDTreeDirArrowExpandable = 'â–¸'
let g:NERDTreeDirArrowCollapsible = 'â–¾'
let NERDTreeMinimalUI = 1
let NERDTreeDirArrows = 1
let NERDTreeAutoCenter=1

" æ˜¯å¦æ˜¾ç¤ºéšè—æ–‡ä»¶
let NERDTreeShowHidden=0
" è®¾ç½®å®½åº¦
let NERDTreeWinSize=25
" åœ¨ç»ˆç«¯å¯åŠ¨vimæ—¶ï¼Œå…±äº«NERDTree
let g:nerdtree_tabs_open_on_console_startup=1
" å¿½ç•¥æ–‡ä»¶çš„æ˜¾ç¤º
let NERDTreeIgnore=['\.pyc','\~$','\.swp','\.class','\.ini']
let g:NERDTreeIndicatorMapCustom = {
    \ "Modified"  : "âœ¹",
    \ "Staged"    : "âœš",
    \ "Untracked" : "âœ­",
    \ "Renamed"   : "âœ",
    \ "Unmerged"  : "â•",
    \ "Deleted"   : "âœ–",
    \ "Dirty"     : "âœ—",
    \ "Clean"     : "âœ”ï¸",
    \ 'Ignored'   : "â˜’",
    \ "Unknown"   : "?"
    \ }

"å¼‚æ­¥è¯­æ³•æ£€æŸ¥
""""""""""""""""""""""""""""""""""""""""""""
let g:ale_set_highlights = 0
"è‡ªå®šä¹‰errorå’Œwarningå›¾æ ‡
let g:ale_sign_error = 'âœ—'
let g:ale_sign_warning = 'âš¡'
"æ˜¾ç¤ºLinteråç§°,å‡ºé”™æˆ–è­¦å‘Šç­‰ç›¸å…³ä¿¡æ¯
let g:ale_echo_msg_error_str = 'E'
let g:ale_echo_msg_warning_str = 'W'
let g:ale_echo_msg_format = '[%linter%] %s [%severity%]'
"æ‰“å¼€æ–‡ä»¶æ—¶ä¸è¿›è¡Œæ£€æŸ¥
let g:ale_lint_on_enter = 0

"æ™®é€šæ¨¡å¼ä¸‹ï¼Œspå‰å¾€ä¸Šä¸€ä¸ªé”™è¯¯æˆ–è­¦å‘Šï¼Œsnå‰å¾€ä¸‹ä¸€ä¸ªé”™è¯¯æˆ–è­¦å‘Š
nmap <leader>sj <Plug>(ale_previous_wrap)
nmap <leader>sn <Plug>(ale_next_wrap)
"<Leader>sè§¦å‘/å…³é—­è¯­æ³•æ£€æŸ¥
nmap <Leader>st :ALEToggle<CR>
"<Leader>dæŸ¥çœ‹é”™è¯¯æˆ–è­¦å‘Šçš„è¯¦ç»†ä¿¡æ¯
nmap <Leader>sd :ALEDetail<CR>
"ä½¿ç”¨clangå¯¹cå’Œc++è¿›è¡Œè¯­æ³•æ£€æŸ¥ï¼Œå¯¹pythonä½¿ç”¨flake8è¿›è¡Œè¯­æ³•æ£€æŸ¥
let g:ale_linters = {
\   'c++': ['g++'],
\   'c': ['gcc'],
\   'python': ['flake8'],
\}

"å¯¹é½
""""""""""""""""""""""""""""""""""""""""""""
" å¿«é€Ÿå¯¹é½
" ,a=        å¯¹é½ç­‰å·è¡¨è¾¾
" ,a:        å¯¹é½å†’å·è¡¨è¾¾å¼(json/mapç­‰)
" # é»˜è®¤å·¦å¯¹é½
" ,a<space>  é¦–ä¸ªç©ºæ ¼å¯¹é½
" ,a2<space> ç¬¬äºŒä¸ªç©ºæ ¼å¯¹é½
" ,a-<space> å€’æ•°ç¬¬ä¸€ä¸ªç©ºæ ¼å¯¹é½
" ,a-2<space> å€’æ•°ç¬¬äºŒä¸ªç©ºæ ¼å¯¹é½
" ,a*<space> æ‰€æœ‰ç©ºæ ¼ä¾æ¬¡å¯¹é½
" # å³å¯¹é½
" ,a<Enter>*<space>

vnoremap <silent> <Enter> :EasyAlign<cr>
if !exists('g:easy_align_delimiters')
  let g:easy_align_delimiters = {}
endif
let g:easy_align_delimiters['#'] = {
\ 'pattern': '#', 'ignore_groups': ['String']
\ }

"å¯¹é½çº¿
"""""""""""""""""""""""""""""""""""""""""""""
" Vim
let g:indentLine_color_term = 239
" GVim
let g:indentLine_color_gui = '#A4E57E'

"æ’¤é”€æ ‘
""""""""""""""""""""""""""""""""""""""""""""
nnoremap <leader>ut :UndotreeToggle<cr>
if has("persistent_undo")
    set undodir=$VIM/undodir/
    set undofile
endif

"multiple selections
""""""""""""""""""""""""""""""""""""""""""""
" å…³é—­é»˜è®¤åŒ¹é…
let g:multi_cursor_use_default_mapping=0
" è‡ªå®šä¹‰åŒ¹é…
let g:multi_cursor_next_key='<leader>mn'
let g:multi_cursor_prev_key='<leader>mp'
let g:multi_cursor_skip_key='<leader>ms'
let g:multi_cursor_quit_key='<Esc>'

"Highlights trailing whitespace
""""""""""""""""""""""""""""""""""""""""""""
nmap <leader>tw :FixWhitespace<cr>

"ä»£ç è¡¥å…¨
""""""""""""""""""""""""""""""""""""""""""""
"ä½¿ç”¨tabè¡¥å…¨
inoremap <expr> <Tab> pumvisible() ? "\<C-n>" : "\<Tab>"
inoremap <expr> <S-Tab> pumvisible() ? "\<C-p>" : "\<S-Tab>"
inoremap <expr> <cr> pumvisible() ? "\<C-y>\<cr>" : "\<cr>"

"taglist
"""""""""""""""""""""""""""""""""""""""""""
nmap <leader>tl :TlistToggle<cr>

"æ³¨é‡Š
""""""""""""""""""""""""""""""""""""""""""""
"<leader>cc   åŠ æ³¨é‡Š
"<leader>cu   è§£å¼€æ³¨é‡Š
"<leader>c<space>  åŠ ä¸Š/è§£å¼€æ³¨é‡Š, æ™ºèƒ½åˆ¤æ–­
"<leader>cy   å…ˆå¤åˆ¶, å†æ³¨è§£(på¯ä»¥è¿›è¡Œé»è´´)

" æ³¨é‡Šçš„æ—¶å€™è‡ªåŠ¨åŠ ä¸ªç©ºæ ¼, å¼ºè¿«ç—‡å¿…é…
let g:NERDSpaceDelims=1

"html
""""""""""""""""""""""""""""""""""""""""""""
let g:user_emmet_expandabbr_key = '<leader>e'
let g:use_emmet_complete_tag = 1
let g:user_emmet_settings = {"lang":"zh-cn"}


""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
"                           auto setting
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
augroup vimrcEx
    au!
    autocmd FileType text setlocal textwidth=78
augroup END

" vim æ–‡ä»¶æŠ˜å æ–¹å¼ä¸º marker
augroup ft_vim
    au!
    autocmd FileType vim setlocal foldmethod=marker

    " æ‰“å¼€æ–‡ä»¶æ€»æ˜¯å®šä½åˆ°ä¸Šæ¬¡ç¼–è¾‘çš„ä½ç½®
    autocmd BufReadPost *
      \ if line("'\"") > 1 && line("'\"") <= line("$") |
      \   exe "normal! g`\"" |
      \ endif
augroup END
